<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfect Print Calendar | School Calendar Editor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --accent: #f59e0b;
            --light: #f8fafc;
            --dark: #1e293b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }

        /* Header */
        .header {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo i {
            font-size: 24px;
            color: var(--primary);
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 800;
            color: var(--dark);
        }

        .logo p {
            font-size: 12px;
            color: #64748b;
            margin-top: 2px;
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: white;
            border: 2px solid var(--border);
            color: var(--dark);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }

        /* Main Container */
        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Editor Panel */
        .editor-panel {
            width: 300px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .panel-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--light);
        }

        .section-title i {
            color: var(--primary);
        }

        /* Color Picker */
        .color-picker {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: var(--dark);
            transform: scale(1.1);
        }

        /* Calendar Preview - EXACTLY WHAT WILL PRINT */
        .calendar-preview {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            min-height: 1000px; /* Ensures enough space for print */
            position: relative;
        }

        /* Print Styles - MOST IMPORTANT PART */
        @media print {
            @page {
                size: A4 portrait;
                margin: 15mm;
            }

            body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                font-size: 11pt !important;
                min-height: auto !important;
                width: 210mm !important;
                height: 297mm !important;
                overflow: hidden !important;
            }

            .no-print {
                display: none !important;
            }

            .main-container {
                display: block !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                height: 100% !important;
            }

            .calendar-preview {
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 !important;
                border-radius: 0 !important;
                min-height: auto !important;
                height: 100% !important;
                width: 100% !important;
                page-break-inside: avoid !important;
                page-break-after: avoid !important;
                overflow: visible !important;
            }

            /* Force A4 dimensions */
            .calendar-content {
                width: 180mm !important; /* 210mm - 30mm margins */
                height: 267mm !important; /* 297mm - 30mm margins */
                margin: 0 auto !important;
                position: relative !important;
                box-sizing: border-box !important;
            }

            /* School Name - Print Optimized */
            .school-name {
                font-size: 24pt !important;
                line-height: 1.2 !important;
                margin-bottom: 8mm !important;
                padding: 3mm 0 !important;
                text-align: center !important;
                color: #1e293b !important;
                font-weight: 800 !important;
                border-bottom: 0.5mm solid #2563eb !important;
                background: white !important;
            }

            /* Month Year - Print Optimized */
            .month-year {
                font-size: 18pt !important;
                line-height: 1 !important;
                margin-bottom: 6mm !important;
                padding: 2mm !important;
                text-align: right !important;
                color: #1e293b !important;
                font-weight: 700 !important;
                background: white !important;
                border: none !important;
            }

            /* Calendar Grid - Print Optimized */
            .calendar-grid {
                border: 0.5mm solid #1e293b !important;
                margin-bottom: 8mm !important;
                border-radius: 2mm !important;
                overflow: hidden !important;
                page-break-inside: avoid !important;
            }

            .calendar-header {
                background: #2563eb !important;
                color: white !important;
            }

            .header-cell {
                padding: 3mm 1mm !important;
                text-align: center !important;
                font-weight: 600 !important;
                color: white !important;
                border-right: 0.2mm solid rgba(255,255,255,0.3) !important;
                font-size: 10pt !important;
            }

            .header-cell:last-child {
                border-right: none !important;
            }

            .header-cell.sunday {
                background: #f59e0b !important;
            }

            .calendar-body {
                border-top: 0.2mm solid #e2e8f0 !important;
            }

            .day-cell {
                padding: 2mm 1mm !important;
                text-align: center !important;
                border-right: 0.2mm solid #e2e8f0 !important;
                border-top: 0.2mm solid #e2e8f0 !important;
                min-height: 18mm !important;
                height: 18mm !important;
                background: white !important;
                page-break-inside: avoid !important;
            }

            .day-cell:nth-child(7n) {
                border-right: none !important;
            }

            .day-cell.empty {
                background: #f8fafc !important;
            }

            .day-cell.sunday {
                background: #fff7ed !important;
            }

            .day-number {
                font-size: 12pt !important;
                font-weight: 700 !important;
                color: #1e293b !important;
                background: #f1f5f9 !important;
                width: 6mm !important;
                height: 6mm !important;
                line-height: 6mm !important;
                border-radius: 50% !important;
                display: inline-block !important;
                margin-bottom: 1mm !important;
            }

            .day-content {
                font-size: 7pt !important;
                line-height: 1.2 !important;
                color: #64748b !important;
                padding: 0.5mm !important;
                background: transparent !important;
                max-height: 8mm !important;
                overflow: hidden !important;
                text-align: left !important;
            }

            /* Info Sections - Print Optimized */
            .info-sections {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 4mm !important;
                margin-bottom: 6mm !important;
                page-break-inside: avoid !important;
            }

            .info-section {
                border: 0.3mm solid #e2e8f0 !important;
                border-radius: 2mm !important;
                overflow: hidden !important;
                background: white !important;
                page-break-inside: avoid !important;
            }

            .section-header {
                padding: 2mm !important;
                background: #2563eb !important;
                color: white !important;
                font-weight: 600 !important;
                font-size: 10pt !important;
                text-align: center !important;
            }

            .section-content {
                padding: 3mm !important;
            }

            .info-item {
                margin-bottom: 1.5mm !important;
                padding: 1.5mm !important;
                background: #f8fafc !important;
                border-radius: 1mm !important;
                border-left: 0.5mm solid #2563eb !important;
                font-size: 9pt !important;
                line-height: 1.4 !important;
                color: #1e293b !important;
                page-break-inside: avoid !important;
            }

            /* Quote Banner - Print Optimized */
            .quote-banner {
                background: linear-gradient(135deg, #2563eb, #10b981) !important;
                padding: 3mm !important;
                border-radius: 2mm !important;
                margin-top: 5mm !important;
                page-break-before: avoid !important;
            }

            .quote-text {
                color: white !important;
                font-size: 10pt !important;
                font-weight: 500 !important;
                text-align: center !important;
                line-height: 1.5 !important;
            }

            /* Hide all hover effects and tools */
            .day-tools,
            .section-tools,
            .item-tools,
            .editor-panel,
            .toolbar,
            .header {
                display: none !important;
            }

            /* Ensure no overflow */
            * {
                max-height: none !important;
                max-width: none !important;
                overflow: visible !important;
                position: static !important;
                box-shadow: none !important;
                transform: none !important;
                transition: none !important;
            }
        }

        /* Calendar Styles - Screen View */
        .school-name {
            text-align: center;
            font-size: 32px;
            font-weight: 900;
            color: var(--dark);
            margin-bottom: 20px;
            padding: 15px;
            border-bottom: 3px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 10px;
        }

        .school-name:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .month-year {
            text-align: right;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .month-year:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }

        .calendar-grid {
            border: 2px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
            background: white;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--primary);
        }

        .header-cell {
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            color: white;
            border-right: 1px solid rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .header-cell:hover {
            background: rgba(255,255,255,0.1);
        }

        .header-cell:last-child {
            border-right: none;
        }

        .header-cell.sunday {
            background: var(--accent);
        }

        .calendar-body {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .day-cell {
            padding: 15px 8px;
            text-align: center;
            border-right: 1px solid var(--border);
            border-top: 1px solid var(--border);
            min-height: 90px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .day-cell:nth-child(7n) {
            border-right: none;
        }

        .day-cell.empty {
            background: #f8fafc;
        }

        .day-cell.sunday {
            background: #fff7ed;
        }

        .day-cell.highlight {
            background: #dbeafe;
        }

        .day-cell:hover {
            background: #f0f9ff;
            transform: scale(1.02);
            z-index: 1;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .day-number {
            display: inline-block;
            width: 32px;
            height: 32px;
            line-height: 32px;
            border-radius: 50%;
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 8px;
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
            background: #f1f5f9;
            color: var(--dark);
        }

        .day-cell:hover .day-number {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .day-content {
            font-size: 11px;
            line-height: 1.4;
            color: var(--dark);
            padding: 4px;
            border-radius: 4px;
            background: rgba(0,0,0,0.02);
            text-align: left;
            max-height: 45px;
            overflow: hidden;
        }

        .day-tools {
            position: absolute;
            top: 8px;
            right: 8px;
            display: none;
            gap: 4px;
        }

        .day-cell:hover .day-tools {
            display: flex;
        }

        .day-tool-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            background: white;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            color: var(--dark);
            transition: all 0.3s;
        }

        .day-tool-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.1);
        }

        /* Info Sections */
        .info-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-section {
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            background: white;
            transition: all 0.3s;
        }

        .info-section:hover {
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .section-header {
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .section-header:hover {
            background: linear-gradient(135deg, var(--primary-dark), #1e40af);
        }

        .section-tools {
            display: flex;
            gap: 8px;
        }

        .section-tool-btn {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .section-tool-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .section-content {
            padding: 20px;
        }

        .info-item {
            margin-bottom: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .info-item:hover {
            background: #f1f5f9;
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .item-content {
            flex: 1;
            padding: 4px;
            border-radius: 4px;
            font-size: 14px;
            color: var(--dark);
        }

        .item-content:hover {
            background: white;
        }

        .item-tools {
            display: flex;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .info-item:hover .item-tools {
            opacity: 1;
        }

        .item-tool-btn {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            background: white;
            border: 1px solid var(--border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .item-tool-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Quote Banner */
        .quote-banner {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quote-banner:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .quote-text {
            color: white;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            line-height: 1.6;
        }

        /* Print Status */
        .print-status {
            background: white;
            border-radius: 8px;
            padding: 10px 15px;
            margin-top: 20px;
            border-left: 4px solid var(--secondary);
            font-size: 13px;
            color: var(--dark);
        }

        .print-status i {
            color: var(--secondary);
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header no-print">
        <div class="logo">
            <div>
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div>
                <h1>Perfect Print Calendar</h1>
                <p>Print exactly what you see on screen - A4 single page</p>
            </div>
        </div>
        <div class="toolbar">
            <button class="btn btn-secondary" onclick="resetCalendar()">
                <i class="fas fa-redo"></i> Reset
            </button>
            <button class="btn btn-secondary" onclick="saveCalendar()">
                <i class="fas fa-save"></i> Save
            </button>
            <button class="btn btn-primary" onclick="printCalendar()">
                <i class="fas fa-print"></i> Print Now (Ctrl+P)
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Editor Panel -->
        <div class="editor-panel no-print">
            <!-- Color Picker -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-palette"></i>
                    Color Picker
                </div>
                <div class="color-picker">
                    <div class="color-option active" style="background: #2563eb;" data-color="#2563eb"></div>
                    <div class="color-option" style="background: #10b981;" data-color="#10b981"></div>
                    <div class="color-option" style="background: #f59e0b;" data-color="#f59e0b"></div>
                    <div class="color-option" style="background: #ef4444;" data-color="#ef4444"></div>
                    <div class="color-option" style="background: #8b5cf6;" data-color="#8b5cf6"></div>
                    <div class="color-option" style="background: #ec4899;" data-color="#ec4899"></div>
                    <div class="color-option" style="background: #14b8a6;" data-color="#14b8a6"></div>
                    <div class="color-option" style="background: #f97316;" data-color="#f97316"></div>
                    <div class="color-option" style="background: #84cc16;" data-color="#84cc16"></div>
                    <div class="color-option" style="background: #64748b;" data-color="#64748b"></div>
                </div>
            </div>

            <!-- Text Tools -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-edit"></i>
                    Text Tools
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="formatText('bold')" style="padding: 8px 12px;">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="formatText('italic')" style="padding: 8px 12px;">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="formatText('underline')" style="padding: 8px 12px;">
                        <i class="fas fa-underline"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="clearFormatting()" style="padding: 8px 12px;">
                        <i class="fas fa-eraser"></i>
                    </button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-bolt"></i>
                    Quick Actions
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn btn-secondary" onclick="editAllNumbers()">
                        <i class="fas fa-edit"></i> Edit All Numbers
                    </button>
                    <button class="btn btn-secondary" onclick="clearAllColors()">
                        <i class="fas fa-ban"></i> Clear All Colors
                    </button>
                    <button class="btn btn-secondary" onclick="addNewSection()">
                        <i class="fas fa-plus"></i> Add New Section
                    </button>
                </div>
            </div>

            <!-- Print Status -->
            <div class="print-status">
                <i class="fas fa-check-circle"></i>
                Print-ready: Everything fits on one A4 page
            </div>
        </div>

        <!-- Calendar Preview -->
        <div class="calendar-preview">
            <div class="calendar-content">
                <!-- School Name -->
                <div class="school-name" contenteditable="true" id="schoolName">
                    ADARSH PUBLIC SCHOOL, PILANI
                </div>

                <!-- Month Year -->
                <div class="month-year" contenteditable="true" id="monthYear">
                    DECEMBER 2025
                </div>

                <!-- Calendar Grid -->
                <div class="calendar-grid">
                    <div class="calendar-header">
                        <div class="header-cell editable" contenteditable="true">MON</div>
                        <div class="header-cell editable" contenteditable="true">TUE</div>
                        <div class="header-cell editable" contenteditable="true">WED</div>
                        <div class="header-cell editable" contenteditable="true">THU</div>
                        <div class="header-cell editable" contenteditable="true">FRI</div>
                        <div class="header-cell editable" contenteditable="true">SAT</div>
                        <div class="header-cell sunday editable" contenteditable="true">SUN</div>
                    </div>
                    <div class="calendar-body" id="calendarBody">
                        <!-- Calendar days will be generated here -->
                    </div>
                </div>

                <!-- Info Sections -->
                <div class="info-sections" id="infoSections">
                    <!-- Sections will be generated here -->
                </div>

                <!-- Quote Banner -->
                <div class="quote-banner">
                    <div class="quote-text" contenteditable="true" id="quoteText">
                        DON'T WORRY WHEN YOU ARE NOT RECOGNISED BUT STRIVE TO BE WORTHY OF RECOGNITION.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Calendar State
        const calendarState = {
            currentMonth: 11, // December
            currentYear: 2025,
            selectedColor: '#2563eb',
            coloredDays: {},
            sections: [],
            editMode: 'text'
        };

        // Initialize Calendar
        document.addEventListener('DOMContentLoaded', function() {
            initCalendar();
            setupEventListeners();
            loadFromStorage();
        });

        // Initialize Calendar
        function initCalendar() {
            generateCalendar();
            generateDefaultSections();
            setupColorPicker();
        }

        // Generate Calendar
        function generateCalendar() {
            const calendarBody = document.getElementById('calendarBody');
            calendarBody.innerHTML = '';
            
            const year = calendarState.currentYear;
            const month = calendarState.currentMonth;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDay = firstDay.getDay();
            
            // Adjust for Monday start
            const adjustedStartDay = startDay === 0 ? 6 : startDay - 1;
            
            // Empty cells
            for (let i = 0; i < adjustedStartDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'day-cell empty';
                calendarBody.appendChild(emptyCell);
            }
            
            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'day-cell';
                dayCell.dataset.day = day;
                
                // Day of week
                const dayOfWeek = (adjustedStartDay + day - 1) % 7;
                if (dayOfWeek === 6) {
                    dayCell.classList.add('sunday');
                }
                
                // Check color
                const dayKey = `${day}-${month}-${year}`;
                if (calendarState.coloredDays[dayKey]) {
                    dayCell.style.backgroundColor = calendarState.coloredDays[dayKey];
                    dayCell.classList.add('highlight');
                }
                
                // Day number (editable)
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number editable';
                dayNumber.contentEditable = true;
                dayNumber.textContent = day;
                dayNumber.onblur = saveState;
                dayNumber.onclick = (e) => {
                    e.stopPropagation();
                    calendarState.editMode = 'number';
                };
                
                // Day tools
                const dayTools = document.createElement('div');
                dayTools.className = 'day-tools';
                dayTools.innerHTML = `
                    <button class="day-tool-btn" onclick="colorDay(${day})">
                        <i class="fas fa-fill-drip"></i>
                    </button>
                    <button class="day-tool-btn" onclick="clearDayColor(${day})">
                        <i class="fas fa-ban"></i>
                    </button>
                `;
                
                // Day content
                const dayContent = document.createElement('div');
                dayContent.className = 'day-content';
                
                dayCell.appendChild(dayNumber);
                dayCell.appendChild(dayTools);
                dayCell.appendChild(dayContent);
                
                // Click handler
                dayCell.onclick = function(e) {
                    if (!e.target.classList.contains('day-tool-btn')) {
                        if (calendarState.editMode === 'color') {
                            applyColorToDay(day);
                        } else {
                            this.querySelector('.day-number').focus();
                        }
                    }
                };
                
                calendarBody.appendChild(dayCell);
            }
        }

        // Generate Default Sections
        function generateDefaultSections() {
            calendarState.sections = [
                {
                    title: "EXAM SCHEDULE",
                    items: [
                        "Exam Schedule",
                        "Weekly Test â€“ 12, 16, 19, 23"
                    ]
                },
                {
                    title: "IMPORTANT CELEBRATION DAY(S)",
                    items: [
                        "03 Wed. International Pollution control day.",
                        "04 Thur. Indian Navy day.",
                        "10 Wed. Human Rights Day.",
                        "23 Tue. Kisan Diwas (National Farmer's Day.)",
                        "25 Thur. Christmas And Good Governance Day."
                    ]
                },
                {
                    title: "HOLIDAY(S)",
                    items: [
                        "According to Shivira Panchang of Govt. Order."
                    ]
                },
                {
                    title: "SCHOOL ACTIVITIES",
                    items: [
                        "07 SUN. PARENT Teacher Meeting ( Nursery to XII )"
                    ]
                }
            ];
            
            renderSections();
        }

        // Render Sections
        function renderSections() {
            const container = document.getElementById('infoSections');
            container.innerHTML = '';
            
            calendarState.sections.forEach((section, sectionIndex) => {
                const sectionElement = document.createElement('div');
                sectionElement.className = 'info-section';
                sectionElement.dataset.section = sectionIndex;
                
                let itemsHTML = '';
                section.items.forEach((item, itemIndex) => {
                    itemsHTML += `
                        <div class="info-item" data-item="${itemIndex}">
                            <div class="item-content editable" contenteditable="true" onblur="saveState()">${item}</div>
                            <div class="item-tools">
                                <button class="item-tool-btn" onclick="moveItemUp(${sectionIndex}, ${itemIndex})">
                                    <i class="fas fa-arrow-up"></i>
                                </button>
                                <button class="item-tool-btn" onclick="moveItemDown(${sectionIndex}, ${itemIndex})">
                                    <i class="fas fa-arrow-down"></i>
                                </button>
                                <button class="item-tool-btn" onclick="removeItem(${sectionIndex}, ${itemIndex})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                sectionElement.innerHTML = `
                    <div class="section-header editable" contenteditable="true" onblur="saveState()">
                        ${section.title}
                        <div class="section-tools">
                            <button class="section-tool-btn" onclick="addItem(${sectionIndex})">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="section-tool-btn" onclick="removeSection(${sectionIndex})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="section-content">
                        ${itemsHTML}
                    </div>
                `;
                
                container.appendChild(sectionElement);
            });
        }

        // Setup Color Picker
        function setupColorPicker() {
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    calendarState.selectedColor = this.dataset.color;
                    calendarState.editMode = 'color';
                    showNotification('Color selected');
                });
            });
        }

        // Apply Color to Day
        function applyColorToDay(day) {
            const dayKey = `${day}-${calendarState.currentMonth}-${calendarState.currentYear}`;
            calendarState.coloredDays[dayKey] = calendarState.selectedColor;
            generateCalendar();
            saveState();
        }

        // Color Specific Day
        function colorDay(day) {
            calendarState.editMode = 'color';
            applyColorToDay(day);
        }

        // Clear Day Color
        function clearDayColor(day) {
            const dayKey = `${day}-${calendarState.currentMonth}-${calendarState.currentYear}`;
            delete calendarState.coloredDays[dayKey];
            generateCalendar();
            saveState();
        }

        // Clear All Colors
        function clearAllColors() {
            if (confirm('Remove all colors from calendar?')) {
                calendarState.coloredDays = {};
                generateCalendar();
                saveState();
                showNotification('All colors cleared');
            }
        }

        // Text Formatting
        function formatText(command) {
            document.execCommand(command, false, null);
            saveState();
        }

        function clearFormatting() {
            document.execCommand('removeFormat', false, null);
            saveState();
            showNotification('Formatting cleared');
        }

        // Edit All Numbers
        function editAllNumbers() {
            const dayNumbers = document.querySelectorAll('.day-number');
            dayNumbers.forEach(number => {
                number.contentEditable = 'true';
                number.focus();
            });
            calendarState.editMode = 'number';
            showNotification('All day numbers are now editable');
        }

        // Section Management
        function addNewSection() {
            const section = {
                title: "NEW SECTION",
                items: ["New item"]
            };
            calendarState.sections.push(section);
            renderSections();
            saveState();
            showNotification('New section added');
        }

        function addItem(sectionIndex) {
            calendarState.sections[sectionIndex].items.push("New item");
            renderSections();
            saveState();
        }

        function removeItem(sectionIndex, itemIndex) {
            if (confirm('Delete this item?')) {
                calendarState.sections[sectionIndex].items.splice(itemIndex, 1);
                renderSections();
                saveState();
            }
        }

        function moveItemUp(sectionIndex, itemIndex) {
            if (itemIndex > 0) {
                const items = calendarState.sections[sectionIndex].items;
                [items[itemIndex], items[itemIndex - 1]] = [items[itemIndex - 1], items[itemIndex]];
                renderSections();
                saveState();
            }
        }

        function moveItemDown(sectionIndex, itemIndex) {
            const items = calendarState.sections[sectionIndex].items;
            if (itemIndex < items.length - 1) {
                [items[itemIndex], items[itemIndex + 1]] = [items[itemIndex + 1], items[itemIndex]];
                renderSections();
                saveState();
            }
        }

        function removeSection(sectionIndex) {
            if (confirm('Delete this entire section?')) {
                calendarState.sections.splice(sectionIndex, 1);
                renderSections();
                saveState();
            }
        }

        // Save State
        function saveState() {
            const state = {
                sections: JSON.parse(JSON.stringify(calendarState.sections)),
                coloredDays: JSON.parse(JSON.stringify(calendarState.coloredDays)),
                currentMonth: calendarState.currentMonth,
                currentYear: calendarState.currentYear,
                schoolName: document.getElementById('schoolName').innerHTML,
                quoteText: document.getElementById('quoteText').innerHTML,
                monthYear: document.getElementById('monthYear').textContent
            };
            
            localStorage.setItem('perfectPrintCalendar', JSON.stringify(state));
        }

        // Save Calendar
        function saveCalendar() {
            saveState();
            showNotification('Calendar saved successfully!');
        }

        // Load Calendar
        function loadCalendar() {
            const saved = localStorage.getItem('perfectPrintCalendar');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    calendarState.sections = data.sections || [];
                    calendarState.coloredDays = data.coloredDays || {};
                    calendarState.currentMonth = data.currentMonth || 11;
                    calendarState.currentYear = data.currentYear || 2025;
                    
                    document.getElementById('schoolName').innerHTML = data.schoolName || 'ADARSH PUBLIC SCHOOL, PILANI';
                    document.getElementById('quoteText').innerHTML = data.quoteText || "DON'T WORRY WHEN YOU ARE NOT RECOGNISED BUT STRIVE TO BE WORTHY OF RECOGNITION.";
                    document.getElementById('monthYear').textContent = data.monthYear || 'DECEMBER 2025';
                    
                    generateCalendar();
                    renderSections();
                    showNotification('Calendar loaded successfully!');
                } catch (e) {
                    showNotification('Error loading calendar');
                }
            } else {
                showNotification('No saved calendar found');
            }
        }

        function loadFromStorage() {
            loadCalendar();
        }

        // Reset Calendar
        function resetCalendar() {
            if (confirm('Reset calendar to default? All unsaved changes will be lost.')) {
                localStorage.removeItem('perfectPrintCalendar');
                
                calendarState.currentMonth = 11;
                calendarState.currentYear = 2025;
                calendarState.coloredDays = {};
                
                document.getElementById('schoolName').textContent = 'ADARSH PUBLIC SCHOOL, PILANI';
                document.getElementById('quoteText').textContent = "DON'T WORRY WHEN YOU ARE NOT RECOGNISED BUT STRIVE TO BE WORTHY OF RECOGNITION.";
                document.getElementById('monthYear').textContent = 'DECEMBER 2025';
                
                generateDefaultSections();
                generateCalendar();
                showNotification('Calendar reset to default');
            }
        }

        // Print Calendar
        function printCalendar() {
            // Optimize layout for printing
            optimizeForPrint();
            
            // Trigger print after a short delay
            setTimeout(() => {
                window.print();
                
                // Restore layout after printing
                setTimeout(() => {
                    restoreAfterPrint();
                }, 1000);
            }, 100);
        }

        // Optimize for print
        function optimizeForPrint() {
            // Ensure everything is visible
            document.querySelectorAll('.calendar-content *').forEach(el => {
                el.style.visibility = 'visible';
                el.style.opacity = '1';
            });
            
            // Force A4 dimensions
            const content = document.querySelector('.calendar-content');
            content.style.width = '180mm';
            content.style.margin = '0 auto';
            
            // Show loading message
            showNotification('Preparing for print...');
        }

        // Restore after print
        function restoreAfterPrint() {
            const content = document.querySelector('.calendar-content');
            content.style.width = '';
            content.style.margin = '';
            
            showNotification('Print completed successfully!');
        }

        // Show Notification
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary);
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                box-shadow: var(--shadow-lg);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
            
            // Add CSS for animations
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Auto-save on blur
            document.addEventListener('blur', function(e) {
                if (e.target.contentEditable === 'true') {
                    saveState();
                }
            }, true);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey) {
                    switch(e.key.toLowerCase()) {
                        case 's':
                            e.preventDefault();
                            saveCalendar();
                            break;
                        case 'p':
                            e.preventDefault();
                            printCalendar();
                            break;
                        case 'z':
                            e.preventDefault();
                            // Undo functionality could be added here
                            break;
                    }
                }
            });
            
            // Prevent Enter from creating new lines in headers
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.target.contentEditable === 'true') {
                    if (e.target.classList.contains('school-name') || 
                        e.target.classList.contains('section-header')) {
                        e.preventDefault();
                        e.target.blur();
                    }
                }
            });
            
            // Color picker click
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    calendarState.selectedColor = this.dataset.color;
                    calendarState.editMode = 'color';
                });
            });
        }
    </script>
</body>
</html>
